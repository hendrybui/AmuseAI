<views:EZModeViewBase x:Class="Amuse.UI.Views.EZMode.ModifyView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:enums="clr-namespace:Amuse.UI.Enums"
             xmlns:views="clr-namespace:Amuse.UI.Views"
             xmlns:ezViews="clr-namespace:Amuse.UI.Views.EZMode"
             xmlns:windows="clr-namespace:Amuse.UI.Windows"
             xmlns:userControls="clr-namespace:Amuse.UI.UserControls"
             xmlns:behaviors="clr-namespace:Amuse.UI.Behaviors"
             xmlns:helpers="clr-namespace:Amuse.UI.Helpers"
             x:Name="UI" 
             mc:Ignorable="d" 
             d:DesignWidth="1100" 
             d:DesignHeight="714" 
             d:DataContext="{d:DesignInstance Type=ezViews:ModifyView}">
    <Grid DataContext="{Binding ElementName=UI}">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition MinWidth="340" >
                <ColumnDefinition.Style>
                    <Style TargetType="{x:Type ColumnDefinition}">
                        <Setter Property="MaxWidth" Value="340" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding WindowState, RelativeSource={RelativeSource AncestorType=Window}}" Value="Maximized">
                                <Setter Property="MaxWidth" Value="550" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </ColumnDefinition.Style>
            </ColumnDefinition>
            <ColumnDefinition Width="*"  />
        </Grid.ColumnDefinitions>


        <!--Left Panel-->
        <DockPanel Grid.Row="0" Grid.Column="0"  Margin="10,5" LastChildFill="True">

            <userControls:StableDiffusionInputControl 
                 Visibility="Collapsed"
                 DockPanel.Dock="Bottom"
                 DiffuserType="TextToImage"
                 IsResolutionEnabled="False"
                 Settings="{Binding Settings, Mode=OneWay}"
                 CurrentPipeline="{Binding CurrentPipeline, Mode=OneWay}"
                 PromptOptions="{Binding PromptOptions, Mode=TwoWay}" 
                 BatchOptions="{Binding BatchOptions, Mode=TwoWay}"
                 SchedulerOptions="{Binding SchedulerOptions, Mode=TwoWay}"
                 IsGenerating="{Binding IsGenerating, Mode=OneWay}"/>

            <userControls:StableDiffusionPickerControl 
                 Visibility="Collapsed"
                 DockPanel.Dock="Top" 
                 Settings="{Binding Settings, Mode=OneWay}"
                 SupportedDiffusers="{Binding SupportedDiffusers, Mode=OneWay}"
                 IsEnabled="{Binding IsGenerating, Converter={StaticResource InverseBoolConverter}, Mode=OneWay}"
                 IsUpscalerSupported="{Binding IsUpscalerSupported, Mode=OneWay}"
                 IsControlNetSupported="{Binding IsControlNetSupported, Mode=OneWay}"
                 IsFeatureExtractorSupported="{Binding IsFeatureExtractorSupported, Mode=OneWay}"
                 IsPipelineLoading="{Binding IsPipelineLoading, Mode=TwoWay}"
                 IsUpscalerEnabled="{Binding IsUpscalerEnabled, Mode=TwoWay}"
                 SelectedBaseModel="{Binding SelectedBaseModel, Mode=TwoWay}"
                 SelectedVariant="{Binding SelectedVariant, Mode=TwoWay}"
                 SelectedUpscaleModel="{Binding SelectedUpscaleModel, Mode=TwoWay}"
                 SelectedControlNetModel="{Binding SelectedControlNetModel, Mode=TwoWay}"
                 CurrentPipeline="{Binding CurrentPipeline, Mode=OneWay}"
                 LoadPipelineCommand="{Binding LoadPipelineCommand, Mode=OneWay}"
                 UnloadPipelineCommand="{Binding UnloadPipelineCommand, Mode=OneWay}"
                 IsControlNetEnabled="{Binding IsControlNetEnabled, Mode=OneWay}"
                 IsSuperResolutionSupported="{Binding IsSuperResolutionSupported, Mode=OneWay}"
                 IsSuperResolutionEnabled="{Binding IsSuperResolutionEnabled, Mode=TwoWay}"/>

            <Border DockPanel.Dock="Top" Margin="0,0,0,10">
                <StackPanel Opacity=".85">
                    <TextBlock Text="Welcome to Amuse Filters!" FontSize="16" TextAlignment="Center"/>
                    <TextBlock Text="Stylize images &amp; videos with AI Assistance " TextAlignment="Center"/>
                </StackPanel>
            </Border>


            <!--Prompt-->
            <DockPanel DockPanel.Dock="Top" >
                <userControls:PromptInputControl 
                  FontSize="11"
                  Margin="0,0,3,0"
                  LabelVisibility="Visible"
                  Settings="{Binding Settings}" 
                  PromptOptions="{Binding PromptOptions, Mode=TwoWay}" 
                  IsNegativePromptSupported="{Binding IsNegativePromptEnabled}" />
                <DockPanel.Style>
                    <Style TargetType="{x:Type DockPanel}">
                        <Setter Property="MinHeight" Value="150" />
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsNegativePromptEnabled, ElementName=UI}" Value="True">
                                <Setter Property="MinHeight" Value="200" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DockPanel.Style>
            </DockPanel>


            <StackPanel DockPanel.Dock="Top" IsEnabled="{Binding IsGenerating, Converter={StaticResource InverseBoolConverter}}">

                <!--Image/Video-->
                <UniformGrid DockPanel.Dock="Top"  Columns="2" Margin="0,0,0,0" Height="40" >
                    <ToggleButton IsChecked="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBoolConverter}}" Margin="0,0,4,0">
                        <DockPanel>
                            <userControls:FontAwesome DockPanel.Dock="Left" Icon="&#xf03e;" IconStyle="Light" Color="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}" Margin="0,0,5,0"/>
                            <TextBlock Text="Image" />
                        </DockPanel>
                    </ToggleButton>
                    <ToggleButton IsChecked="{Binding IsVideoGenerationMode}" Margin="4,0,0,0">
                        <DockPanel>
                            <userControls:FontAwesome DockPanel.Dock="Left" Icon="&#xf008;" IconStyle="Light" Color="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}" Margin="0,0,5,0"/>
                            <TextBlock Text="Video" />
                        </DockPanel>
                    </ToggleButton>
                </UniformGrid>


                <!--Model Quality-->
                <DockPanel DockPanel.Dock="Top" Margin="0,10,0,0" Visibility="Collapsed">
                    <TextBlock DockPanel.Dock="Top" Text="Perfomance" Style="{StaticResource FieldTextBlockStyle}" TextAlignment="Center"/>
                    <Slider DockPanel.Dock="Top" Value="{Binding SelectedModelQuality, Mode=TwoWay, Converter={StaticResource ValueToEnumConverter}}" Minimum="0" Maximum="2" IsSnapToTickEnabled="True" TickFrequency="1" TickPlacement="BottomRight" >
                        <i:Interaction.Behaviors>
                            <behaviors:SliderMouseWheelBehavior />
                        </i:Interaction.Behaviors>
                    </Slider>
                    <UniformGrid Columns="3">
                        <TextBlock Text="Fast" TextAlignment="Left" FontSize="8" Opacity=".6" FontStyle="Italic" />
                        <TextBlock Text="Balanced" TextAlignment="Center" FontSize="8" Opacity=".6" FontStyle="Italic" />
                        <TextBlock Text="Quality" TextAlignment="Right"  FontSize="8" Opacity=".6" FontStyle="Italic" />
                    </UniformGrid>
                </DockPanel>


                <!--Batch + Resolution-->
                <UniformGrid Columns="2" DockPanel.Dock="Top" Margin="0,10,0,0" >

                    <!--Batch Count-->
                    <DockPanel DockPanel.Dock="Top" Margin="0,0,4,0">
                        <TextBlock DockPanel.Dock="Top" TextAlignment="Center">
                            <TextBlock.Style>
                                <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource FieldTextBlockStyle}">
                                    <Setter Property="Text" Value="Image Count" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsVideoGenerationMode, ElementName=UI}" Value="True">
                                            <Setter Property="Text" Value="Video Count" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <DockPanel Margin="0,4,0,0">
                            <TextBlock DockPanel.Dock="Right" Style="{StaticResource FieldTextBlockStyle}" Text="{Binding BatchOptions.ValueTo, StringFormat={}{0}}" VerticalAlignment="Top" HorizontalAlignment="Right" FontSize="12" Margin="0,0,8,0" FontWeight="Medium" />
                            <Slider Value="{Binding BatchOptions.ValueTo}" Minimum="1" Maximum="10" TickFrequency="1" IsSnapToTickEnabled="True" SmallChange="1" LargeChange="1" >
                                <i:Interaction.Behaviors>
                                    <behaviors:SliderMouseWheelBehavior />
                                </i:Interaction.Behaviors>
                            </Slider>
                        </DockPanel>
                    </DockPanel>


                    <!--Model Resolution-->
                    <DockPanel Margin="4,0,0,0">
                        <TextBlock DockPanel.Dock="Top" Text="Aspect Ratio" Style="{StaticResource FieldTextBlockStyle}" TextAlignment="Center"/>
                        <UniformGrid Columns="3" >
                            <UniformGrid.Resources>
                                <Style x:Key="ResolutionSelectedIconStyle" TargetType="{x:Type userControls:FontAwesome}" BasedOn="{StaticResource {x:Type userControls:FontAwesome}}">
                                    <Style.Triggers>
                                        <Trigger Property="IsEnabled" Value="False">
                                            <Setter Property="Color" Value="{StaticResource InfoColour}" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </UniformGrid.Resources>

                            <Grid ToolTipService.ShowOnDisabled="True" ToolTipService.Placement="Center" ToolTipService.VerticalOffset="-32"  >
                                <Button  Padding="4" Command="{Binding SelectResolutionCommand}">
                                    <Button.CommandParameter>
                                        <enums:HardwareProfileAspectType>Default</enums:HardwareProfileAspectType>
                                    </Button.CommandParameter>
                                    <userControls:FontAwesome  Icon="&#xf0c8;" Style="{StaticResource ResolutionSelectedIconStyle}"/>
                                </Button>
                                <Grid.ToolTip>
                                    <TextBlock>
                          <Run Text="Square (" />
                          <Run Text="{Binding ProfileOption.Default.Width}" />
                          <Run Text="x" />
                          <Run Text="{Binding ProfileOption.Default.Height}" />
                          <Run Text=")" />
                                    </TextBlock>
                                </Grid.ToolTip>
                                <Grid.Style>
                                    <Style TargetType="{x:Type Grid}">
                                        <Setter Property="IsEnabled" Value="True" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedResolution}" Value="Default">
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                            </Grid>
                            <Grid ToolTipService.ShowOnDisabled="True" ToolTipService.Placement="Center" ToolTipService.VerticalOffset="-32">
                                <Button Command="{Binding SelectResolutionCommand}" >
                                    <Button.CommandParameter>
                                        <enums:HardwareProfileAspectType>Landscape</enums:HardwareProfileAspectType>
                                    </Button.CommandParameter>
                                    <userControls:FontAwesome  Icon="&#xf2fc;" Style="{StaticResource ResolutionSelectedIconStyle}"/>
                                </Button>
                                <Grid.ToolTip>
                                    <TextBlock >
                          <Run Text="Landscape (" />
                          <Run Text="{Binding ProfileOption.Landscape.Width}" />
                          <Run Text="x" />
                          <Run Text="{Binding ProfileOption.Landscape.Height}" />
                          <Run Text=")" />
                                    </TextBlock>
                                </Grid.ToolTip>
                                <Grid.Style>
                                    <Style TargetType="{x:Type Grid}">
                                        <Setter Property="IsEnabled" Value="True" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedResolution}" Value="Landscape">
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                            </Grid>
                            <Grid ToolTipService.ShowOnDisabled="True" ToolTipService.Placement="Center" ToolTipService.VerticalOffset="-32"  >
                                <Button Command="{Binding SelectResolutionCommand}">
                                    <Button.CommandParameter>
                                        <enums:HardwareProfileAspectType>Portrait</enums:HardwareProfileAspectType>
                                    </Button.CommandParameter>
                                    <userControls:FontAwesome  Icon="&#xf2fb;" Style="{StaticResource ResolutionSelectedIconStyle}"/>
                                </Button>
                                <Grid.ToolTip>
                                    <TextBlock >
                          <Run Text="Portrait (" />
                          <Run Text="{Binding ProfileOption.Portrait.Width}" />
                          <Run Text="x" />
                          <Run Text="{Binding ProfileOption.Portrait.Height}" />
                          <Run Text=")" />
                                    </TextBlock>
                                </Grid.ToolTip>
                                <Grid.Style>
                                    <Style TargetType="{x:Type Grid}">
                                        <Setter Property="IsEnabled" Value="True" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding SelectedResolution}" Value="Portrait">
                                                <Setter Property="IsEnabled" Value="False" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Grid.Style>
                            </Grid>
                        </UniformGrid>
                    </DockPanel>

                </UniformGrid>


                <!--ControlNet-->
                <DockPanel Visibility="Collapsed">
                    <TextBlock DockPanel.Dock="Top" Text="Assistant" FontSize="8" Style="{StaticResource FieldTextBlockStyle}" HorizontalAlignment="Left"/>
                    <ComboBox Height="26" ItemsSource="{Binding ProfileOption.ControlNet}" SelectedItem="{Binding SelectedControlNetProfile}" >
                        <ComboBox.ItemContainerStyle>
                            <Style TargetType="{x:Type ComboBoxItem}">
                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                            </Style>
                        </ComboBox.ItemContainerStyle>
                    </ComboBox>
                </DockPanel>


                <!--Strength-->
                <UniformGrid Columns="1" Margin="0,10,0,0">
                    <!--<DockPanel>
                        <DockPanel DockPanel.Dock="Top">
                            <TextBlock DockPanel.Dock="Left" Text="Strength" TextWrapping="Wrap" FontSize="8" Opacity=".6" FontStyle="Italic" Margin="4,0,0,0"/>
                            <TextBlock DockPanel.Dock="Right" Text="{Binding GenerateStrength, StringFormat={}{0:F2}}" FontSize="8"  Opacity=".6" FontWeight="Medium" TextAlignment="Right" Margin="0,0,5,0"/>
                        </DockPanel>
                        <Slider Value="{Binding GenerateStrength}" Minimum="0" Maximum="1" TickFrequency="0.01" IsSnapToTickEnabled="True" SmallChange="0.01" LargeChange="0.1" >
                            <i:Interaction.Behaviors>
                                <behaviors:SliderMouseWheelBehavior />
                            </i:Interaction.Behaviors>
                        </Slider>
                    </DockPanel>-->
                    <DockPanel>
                        <DockPanel DockPanel.Dock="Top">
                            <TextBlock DockPanel.Dock="Left" Text="Strength" Style="{StaticResource FieldTextBlockStyle}"/>
                            <TextBlock DockPanel.Dock="Right" Text="{Binding AssistantStrength, Converter={StaticResource MutiplyByConverter}, ConverterParameter=100, StringFormat={}{0:F0}%}" Style="{StaticResource FieldTextBlockStyle}" TextAlignment="Right"/>
                        </DockPanel>
                        <Slider Value="{Binding AssistantStrength}" Minimum="0" Maximum="1" TickFrequency="0.01" IsSnapToTickEnabled="True" SmallChange="0.01" LargeChange="0.1" >
                            <i:Interaction.Behaviors>
                                <behaviors:SliderMouseWheelBehavior />
                            </i:Interaction.Behaviors>
                        </Slider>
                    </DockPanel>
                </UniformGrid>


                <!--Video Options-->
                <StackPanel Margin="0,5,0,0" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <DockPanel DockPanel.Dock="Top">
                        <TextBlock DockPanel.Dock="Left" Text="Coherency Fix"  Style="{StaticResource FieldTextBlockStyle}"/>
                        <TextBlock DockPanel.Dock="Right" Text="{Binding SelectedCoherency}" Style="{StaticResource FieldTextBlockStyle}" TextAlignment="Right" />
                    </DockPanel>
                    <Slider DockPanel.Dock="Top" Value="{Binding SelectedCoherency, Mode=TwoWay, Converter={StaticResource ValueToEnumConverter}}" Minimum="0" Maximum="2" IsSnapToTickEnabled="True" TickFrequency="1">
                        <i:Interaction.Behaviors>
                            <behaviors:SliderMouseWheelBehavior />
                        </i:Interaction.Behaviors>
                    </Slider>
                </StackPanel>


                <!--AMD XDNA + Options-->
                <DockPanel  DockPanel.Dock="Top" Margin="0,2,0,0" >
                    <UniformGrid DockPanel.Dock="Right" Columns="2" Height="50"  Margin="4,0,0,0" HorizontalAlignment="Right" VerticalAlignment="Top">
                        <ToggleButton IsChecked="{Binding IsRandomSeedEnabled}" Width="40" Margin="0,0,2,0">
                            <userControls:FontAwesome Icon="&#xf074;" IconStyle="Light" Color="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}" ToolTip="Create new variant each generation"/>
                        </ToggleButton>
                        <ToggleButton IsChecked="{Binding BatchOptions.IsRealtimeEnabled}" Width="40" Margin="2,0,0,0" IsEnabled="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBoolConverter}}">
                            <userControls:FontAwesome Icon="&#xf021;" IconStyle="Light" Color="{Binding Foreground, RelativeSource={RelativeSource AncestorType={x:Type ToggleButton}}}" ToolTip="Realtime Stable Diffusion"/>
                        </ToggleButton>
                    </UniformGrid>
                    <StackPanel VerticalAlignment="Center" Margin="0,10,0,0">
                        <CheckBox IsChecked="{Binding IsSuperResolutionEnabled}" Style="{StaticResource SwitchBox}" Margin="0,0,0,3" IsEnabled="{Binding IsSuperResolutionSupported}" ToolTip="Requires an AMD XDNA™ based NPU" ToolTipService.ShowOnDisabled="True">
                            <TextBlock Text="AMD XDNA™ Super Resolution" TextAlignment="Center" FontSize="11"/>
                        </CheckBox>
                    </StackPanel>
                </DockPanel>

            </StackPanel>


            <!--Generate Buttons-->
            <Grid DockPanel.Dock="Bottom" Margin="0,0,0,6" Height="40">
                <Grid Visibility="{Binding IsGenerating, Converter={StaticResource InverseBooleanToVisibilityConverter}}">

                    <Button Command="{Binding GenerateImageCommand}" Style="{StaticResource SuccessButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}"  >
                        <DockPanel>
                            <userControls:FontAwesome Icon="&#xe2ca;" IconStyle="Light" Color="{StaticResource SuccessColour}"/>
                            <TextBlock Margin="5,0" Foreground="{StaticResource SuccessColour}">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Text" Value="Generate Images" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding BatchOptions.ValueTo, ElementName=UI}" Value="1" >
                                                <Setter Property="Text" Value="Generate Image" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding BatchOptions.IsRealtimeEnabled, ElementName=UI}" Value="True" >
                                                <Setter Property="Text" Value="Start Realtime Generation" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DockPanel>
                    </Button>

                    <Button Command="{Binding GenerateVideoCommand}" Style="{StaticResource SuccessButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}"  >
                        <DockPanel>
                            <userControls:FontAwesome Icon="&#xe2ca;" IconStyle="Light" Color="{StaticResource SuccessColour}"/>
                            <TextBlock Margin="5,0" Foreground="{StaticResource SuccessColour}">
                                <TextBlock.Style>
                                    <Style TargetType="{x:Type TextBlock}">
                                        <Setter Property="Text" Value="Generate Videos" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding BatchOptions.ValueTo, ElementName=UI}" Value="1" >
                                                <Setter Property="Text" Value="Generate Video" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding BatchOptions.IsRealtimeEnabled, ElementName=UI}" Value="True" >
                                                <Setter Property="Text" Value="Start Realtime Generation" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </DockPanel>
                    </Button>

                </Grid>

                <Button Command="{Binding CancelCommand}" Style="{StaticResource WarningButtonStyle}" Visibility="{Binding IsGenerating, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <DockPanel>
                        <userControls:FontAwesome Icon="&#xf00d;" IconStyle="Light" Color="{StaticResource WarningColour}"/>
                        <TextBlock Text="Cancel Generation" Margin="5,0" Foreground="{StaticResource WarningColour}"/>
                    </DockPanel>
                </Button>
            </Grid>

            <!--Debug-->
            <StackPanel  DockPanel.Dock="Top" VerticalAlignment="Bottom" Margin="4" Visibility="Hidden">
                <TextBlock Text="Debug:" FontSize="10" Opacity=".6" FontStyle="Italic"/>
                <TextBlock Text="{Binding SelectedModelTemplate.Name}" />
                <TextBlock Text="{Binding SelectedControlNetTemplate.Name, StringFormat={}ControlNet: {0}}" />
                <TextBlock Text="{Binding SelectedFeatureExtractorTemplate.Name, StringFormat={}Extractor: {0}}" />
                <UniformGrid Columns="4"  >
                    <TextBlock Text="{Binding SchedulerOptions.Width, StringFormat={}Width: {0}}"/>
                    <TextBlock Text="{Binding SchedulerOptions.Height, StringFormat={}Height: {0}}" TextAlignment="Center"/>
                    <TextBlock Text="{Binding SchedulerOptions.InferenceSteps, StringFormat={}Steps: {0}}" TextAlignment="Right"/>
                </UniformGrid>
            </StackPanel>
        </DockPanel>


        <!--Right Panel-->
        <DockPanel Grid.Row="0" Grid.Column="1">

            <!--Result List-->
            <Grid DockPanel.Dock="Bottom" >

                <DockPanel Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                    <ItemsControl ItemsSource="{Binding ImageResults}" MaxHeight="190">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="{Binding ImageResults.Count, ElementName=UI}" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ControlDefaultBorderBrush}" BorderThickness="1" Margin="1" >
                                    <Grid>
                                        <userControls:FontAwesome Icon="&#xe1e0;" IconStyle="Thin" Size="30" Opacity=".3" />
                                        <Button BorderThickness="0" 
                                                Style="{StaticResource TransparentButton}"
                                                Command="{Binding ShowImagePreviewCommand, ElementName=UI}"
                                                CommandParameter="{Binding}"
                                                IsHitTestVisible="{Binding OnnxImage, Converter={StaticResource NullBooleanConverter}}">
                                            <Grid>
                                                <Image Source="{Binding PreviewImage}" />
                                                <Image Source="{Binding Image}"/>
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <DockPanel.Style>
                        <Style TargetType="{x:Type DockPanel}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ImageResults.Count}" Value="0">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DockPanel.Style>
                </DockPanel>


                <DockPanel Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ItemsControl ItemsSource="{Binding VideoResults}" MaxHeight="190">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <UniformGrid Columns="{Binding VideoResults.Count, ElementName=UI}" />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border BorderBrush="{StaticResource ControlDefaultBorderBrush}" BorderThickness="1" Margin="1" >
                                    <Grid>
                                        <userControls:FontAwesome Icon="&#xe1e0;" IconStyle="Thin" Size="30" Opacity=".3" />
                                        <Button BorderThickness="0" 
                                                Style="{StaticResource TransparentButton}"
                                                Command="{Binding ShowVideoPreviewCommand, ElementName=UI}"
                                                CommandParameter="{Binding}"
                                                IsHitTestVisible="{Binding Video, Converter={StaticResource NullBooleanConverter}}">
                                            <Grid>
                                                <Image Source="{Binding Thumbnail}" />
                                                <MediaElement Source="{Binding FileName}"/>
                                            </Grid>
                                        </Button>
                                    </Grid>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <DockPanel.Style>
                        <Style TargetType="{x:Type DockPanel}">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ImageResults.Count}" Value="0">
                                    <Setter Property="Visibility" Value="Collapsed" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DockPanel.Style>
                </DockPanel>

            </Grid>


            <!--Progressbar-->
            <Grid DockPanel.Dock="Bottom" Margin="2,0,0,2">
                <userControls:ProgressElement Progress="{Binding Progress}" />
            </Grid>

            <!--Input / Result-->
            <UniformGrid  Columns="2">

                <Grid  Margin="1,1,3,1">
                    <!--Image Input-->
                    <userControls:ImageInputControl x:Name="ImageInputControl"
                        SourceImage="{Binding SourceImage}"
                        ImageWidth="{Binding SchedulerOptions.Width}"
                        ImageHeight="{Binding SchedulerOptions.Height}"
                        Result="{Binding InputImage, Mode=TwoWay}" 
                        IsEnabled="True"
                        IsCropDialogEnabled="True"
                        ToolbarVisibility="Collapsed"
                        Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

                    <!--Video Input-->
                    <userControls:VideoInputControl x:Name="VideoInputControl"
                        SourceVideo="{Binding SourceVideo}"
                        Result="{Binding InputVideo, Mode=TwoWay}"
                        VideoWidth="{Binding SchedulerOptions.Width}"
                        VideoHeight="{Binding SchedulerOptions.Width}"
                        IsEnabled="True"
                        ToolbarVisibility="Collapsed"
                        VideoSync="{Binding VideoSync}"
                        Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                </Grid>


                <!--Main Result-->
                <Border BorderBrush="{StaticResource ControlBrightDefaultBorderBrush}" BorderThickness="2"  Padding="2" Margin="3,1,1,1">
                    <Grid>
                        <userControls:EZModeResultControl
                            IsSplitterEnabled="True"
                            Result="{Binding ResultImage}" 
                            Preview="{Binding PreviewResult}"
                            Original="{Binding InputImage}"
                            CopyImageCommand="{Binding CopyImageCommand}"
                            SaveImageCommand="{Binding SaveImageCommand}" 
                            Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}"/>

                        <userControls:EZModeVideoResultControl
                            IsSplitterEnabled="True"
                            Result="{Binding ResultVideo}" 
                            Preview="{Binding PreviewResult}"
                            Original="{Binding InputVideo}"
                            CopyVideoCommand="{Binding CopyVideoCommand}"
                            SaveVideoCommand="{Binding SaveVideoCommand}" 
                            VideoSync="{Binding VideoSync}"
                            Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}"/>
                    </Grid>
                </Border>

            </UniformGrid>

        </DockPanel>

        <!--Left Toolbar Menu-->
        <Border Grid.Row="1" Grid.Column="0" BorderBrush="{StaticResource ContainerBorder}" Background="{StaticResource ContainerBorder}" BorderThickness="1" Height="40">

            <DockPanel >
                <StackPanel DockPanel.Dock="Left" Orientation="Horizontal">
                    <Button Style="{StaticResource TransparentButton}" Command="{Binding ShowNormalModeCommand}" Margin="6,2,2,2" ToolTip="Expert Mode">
                        <StackPanel Orientation="Horizontal">
                            <userControls:FontAwesome Icon="&#xe5f1;" IconStyle="Light" Size="15" />
                            <TextBlock Text="Expert Mode" Margin="4,0,0,0"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TransparentButton}" Command="{Binding SettingsDialogCommand}" Margin="10,2,2,2" ToolTip="Settings">
                        <StackPanel Orientation="Horizontal">
                            <userControls:FontAwesome Icon="&#xf1de;" IconStyle="Light" Size="15" />
                            <TextBlock Text="Settings" Margin="4,0,0,0"/>
                        </StackPanel>
                    </Button>
                    <Button Style="{StaticResource TransparentButton}" Command="{Binding OpenDirectoryCommand}" CommandParameter="{Binding LogDirectory, Source={x:Static Application.Current}}" Margin="10,2,2,2" ToolTip="Information" >
                        <StackPanel Orientation="Horizontal">
                            <userControls:FontAwesome Icon="&#xf56f;" IconStyle="Light" Size="15" />
                            <TextBlock Text="Logs" Margin="4,0,0,0"/>
                        </StackPanel>
                    </Button>
                </StackPanel>
                <Button DockPanel.Dock="Right" Style="{StaticResource TransparentButton}" Command="{Binding InfoDialogCommand}" Margin="2" Width="34" ToolTip="Information">
                    <userControls:FontAwesome Icon="&#xf30f;" IconStyle="Light" Size="15" />
                </Button>
                <TextBlock />
            </DockPanel>

        </Border>


        <!--Right Toolbar Menu-->
        <Border Grid.Row="1" Grid.Column="1" BorderBrush="{StaticResource ContainerBorder}" Background="{StaticResource ContainerBorder}" BorderThickness="1" Height="40">
            <DockPanel>
                <DockPanel DockPanel.Dock="Left">
                    <StackPanel Orientation="Horizontal" Margin="4" >
                        <Grid Width="110" >
                            <Button Command="{Binding LoadImageCommand, ElementName=ImageInputControl, Mode=OneWay}" Style="{StaticResource InfoButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Thin" Color="{StaticResource SuccessColour}"/>
                                    <TextBlock Text="Load Image" Foreground="{StaticResource SuccessColour}" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Button>
                            <Button  Command="{Binding LoadVideoCommand, ElementName=VideoInputControl, Mode=OneWay}"  Style="{StaticResource InfoButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Thin" Color="{StaticResource SuccessColour}"/>
                                    <TextBlock Text="Load Video" Foreground="{StaticResource SuccessColour}" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Button>
                        </Grid>

                        <Grid>
                            <Button Command="{Binding ClearImageCommand, ElementName=ImageInputControl, Mode=OneWay}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}">
                                <userControls:FontAwesome Icon="&#xe2b4;" IconStyle="Thin" Width="36" Margin="0,0,1,0" Color="{StaticResource DangerColour}"/>
                            </Button>
                            <Button Command="{Binding ClearVideoCommand, ElementName=VideoInputControl, Mode=OneWay}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}">
                                <userControls:FontAwesome Icon="&#xe2b4;" IconStyle="Thin" Width="36" Margin="0,0,1,0" Color="{StaticResource DangerColour}"/>
                            </Button>
                        </Grid>

                    </StackPanel>
                </DockPanel>

                <DockPanel DockPanel.Dock="Right">
                    <StackPanel Orientation="Horizontal" Margin="4" >
                        <Grid Width="110" >
                            <Button Command="{Binding SaveImageCommand}" CommandParameter="{Binding ResultImage}" Style="{StaticResource InfoButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource InverseBooleanToVisibilityConverter}}" IsEnabled="{Binding ResultImage, Converter={StaticResource NullBooleanConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Thin" Color="{StaticResource InfoColour}"/>
                                    <TextBlock Text="Save Image" Foreground="{StaticResource InfoColour}" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Button>
                            <Button  Command="{Binding SaveVideoCommand}" CommandParameter="{Binding ResultVideo}" Style="{StaticResource InfoButtonStyle}" Visibility="{Binding IsVideoGenerationMode, Converter={StaticResource BooleanToVisibilityConverter}}" IsEnabled="{Binding ResultVideo, Converter={StaticResource NullBooleanConverter}}">
                                <StackPanel Orientation="Horizontal">
                                    <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Thin" Color="{StaticResource InfoColour}"/>
                                    <TextBlock Text="Save Video" Foreground="{StaticResource InfoColour}" Margin="5,0,0,0"/>
                                </StackPanel>
                            </Button>
                        </Grid>
                        <Button Command="{Binding ClearHistoryCommand}" >
                            <userControls:FontAwesome Icon="&#xe2b4;" IconStyle="Thin" Width="36" Margin="0,0,1,0" Color="{StaticResource DangerColour}"/>
                        </Button>
                    </StackPanel>
                </DockPanel>

                <StackPanel   Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" Margin="3,0" >
                    <StackPanel Orientation="Horizontal" Margin="5,0,0,0" VerticalAlignment="Center" >
                        <TextBlock Text="Elapsed: " Style="{StaticResource FieldTextBlockStyle}" Margin="0,1,0,0" />
                        <TextBlock Text="{Binding Statistics.TotalElapsed.TotalSeconds, FallbackValue=0.0, StringFormat={}{0:F1}}" VerticalAlignment="Center" />
                        <TextBlock Text=" s" VerticalAlignment="Center"/>
                    </StackPanel>
                    <!--<StackPanel Orientation="Horizontal" Margin="20,0,0,0" VerticalAlignment="Center" >
                        <TextBlock Text="Compute: " Style="{StaticResource FieldTextBlockStyle}" Margin="0,1,0,0" />
                        <TextBlock Text="{Binding Statistics.Elapsed.TotalSeconds, FallbackValue=0.0, StringFormat={}{0:F1}}" VerticalAlignment="Center" />
                        <TextBlock Text=" s" VerticalAlignment="Center"/>
                    </StackPanel>-->
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" Margin="20,0,0,0">
                        <TextBlock Text="Performance: " Style="{StaticResource FieldTextBlockStyle}" Margin="0,1,0,0" />
                        <TextBlock Text="{Binding Statistics.IterationsSec, FallbackValue=0.0, StringFormat={}{0:F2}}" VerticalAlignment="Center" />
                        <TextBlock Text=" it/s" VerticalAlignment="Center"/>
                    </StackPanel>
                </StackPanel>
            </DockPanel>
        </Border>

    </Grid>

</views:EZModeViewBase>
