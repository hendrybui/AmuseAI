<UserControl x:Class="Amuse.UI.UserControls.FeatureExtractorResultControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:userControls="clr-namespace:Amuse.UI.UserControls"
             xmlns:behaviors="clr-namespace:Amuse.UI.Behaviors"
             xmlns:models="clr-namespace:Amuse.UI.Models"
             Name="UI" 
             Focusable="True">
    <UserControl.InputBindings>
        <KeyBinding Modifiers="Ctrl" Key="C" Command="{Binding CopyImageCommand, ElementName=UI}" CommandParameter="{Binding Result, ElementName=UI}" />
        <KeyBinding Modifiers="Ctrl" Key="S" Command="{Binding SaveImageCommand, ElementName=UI}" CommandParameter="{Binding Result, ElementName=UI}" />
    </UserControl.InputBindings>
    <Border DataContext="{Binding ElementName=UI}" BorderBrush="{StaticResource ControlBrightDefaultBorderBrush}" BorderThickness="2" >
        <DockPanel Margin="2">

            <StackPanel DockPanel.Dock="Bottom" >

                <!--Progress-->
                <Grid Height="35" Visibility="{Binding Result, Converter={StaticResource InverseNullVisibilityConverter}}">
                    <userControls:ProgressElement Progress="{Binding Progress}" Margin="1, 5"/>
                </Grid>

                <!--Information-->
                <UniformGrid Height="35" Columns="3" Visibility="{Binding Result, Converter={StaticResource NullVisibilityConverter}}">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="15,0,0,0" >
                        <TextBlock Text="Model:" Margin="0,0,5,0" FontStyle="Italic" Opacity=".6"/>
                        <TextBlock Text="{Binding FeatureExtractorInfo.Name}" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Center" >
                        <TextBlock Text="Size:" Margin="0,0,5,0" FontStyle="Italic" Opacity=".6"/>
                        <TextBlock Text="{Binding Result.Width}" />
                        <TextBlock Text="x" Margin="2,0,2,0"/>
                        <TextBlock Text="{Binding Result.Height}" />
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,15,0" >
                        <TextBlock Text="Elapsed:" Margin="0,0,5,0" FontStyle="Italic" Opacity=".6"/>
                        <TextBlock Text="{Binding Result.Elapsed, StringFormat={}{0:F2} s}" />
                    </StackPanel>
                </UniformGrid>

                <!--Action Buttons-->
                <DockPanel Height="35" IsEnabled="{Binding Result, Converter={StaticResource NullBooleanConverter}}">
                    <Button Width="100" DockPanel.Dock="Left" Style="{StaticResource InfoButtonStyle}" Command="{Binding SaveImageCommand}" CommandParameter="{Binding Result}" ToolTip="Save Image File">
                        <StackPanel Orientation="Horizontal">
                            <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Light"  Color="{StaticResource InfoColour}" />
                            <TextBlock Text="Save" Margin="8,0,0,0" Foreground="{StaticResource InfoColour}"/>
                        </StackPanel>
                    </Button>
                    <Button DockPanel.Dock="Right" Width="50" Command="{Binding RemoveImageCommand}" CommandParameter="{Binding Result}" ToolTip="Clear Image Result" BorderThickness="1" Style="{StaticResource DangerButtonStyle}">
                        <userControls:FontAwesome Icon="&#xf2ed;" IconStyle="Light" Color="{StaticResource DangerColour}" />
                    </Button>
                    <UniformGrid Columns="4"  >
                        <Button Command="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type Window}}, Path=NavigateCommand}" ToolTip="Send To Image To Image">
                            <userControls:FontAwesome Icon="&#xf03e;" IconStyle="Light" />
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource NavigationConverter}">
                                    <Binding Source="{x:Static models:MenuId.Image}" />
                                    <Binding Source="{x:Static models:ImageSubmenuId.ImageToImage}" />
                                    <Binding Path="Result"/>
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>
                        <Button Command="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type Window}}, Path=NavigateCommand}" ToolTip="Send To Image Inpaint">
                            <userControls:FontAwesome Icon="&#xf044;" IconStyle="Light" />
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource NavigationConverter}">
                                    <Binding Source="{x:Static models:MenuId.Image}" />
                                    <Binding Source="{x:Static models:ImageSubmenuId.ImageInpaint}" />
                                    <Binding Path="Result"/>
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>
                        <Button Command="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type Window}}, Path=NavigateCommand}" ToolTip="Send To ImageToVideo">
                            <userControls:FontAwesome Icon="&#xf008;" IconStyle="Light" />
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource NavigationConverter}">
                                    <Binding Source="{x:Static models:MenuId.Video}" />
                                    <Binding Source="{x:Static models:VideoSubmenuId.ImageToVideo}" />
                                    <Binding Path="Result"/>
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>
                        <Button Command="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type Window}}, Path=NavigateCommand}" ToolTip="Send To Upscaler">
                            <userControls:FontAwesome Icon="&#xf424;" IconStyle="Light" />
                            <Button.CommandParameter>
                                <MultiBinding Converter="{StaticResource NavigationConverter}">
                                    <Binding Source="{x:Static models:MenuId.Image}" />
                                    <Binding Source="{x:Static models:ImageSubmenuId.Upscaler}" />
                                    <Binding Path="Result"/>
                                </MultiBinding>
                            </Button.CommandParameter>
                        </Button>
                    </UniformGrid>
                </DockPanel>
            </StackPanel>

            <!--Result Image-->
            <userControls:ImageElement 
                Original="{Binding Source.Image}" 
                Source="{Binding Result.Image}"
                IsSplitterEnabled="True"
                SplitterDirection="LeftToRight"
                SplitterPosition="Source"
                SplitterVisibility="Auto">

                <!--Context Menu-->
                <userControls:ImageElement.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Extractor Menu" IsEnabled="False"  Margin="0,0,0,4" FontSize="13" FontWeight="DemiBold"/>
                        <Separator Margin="0,0,0,5"/>
                        <MenuItem Header="Copy" InputGestureText="Ctrl+C" Command="{Binding CopyImageCommand}" CommandParameter="{Binding Result}" IsEnabled="{Binding Result, Converter={StaticResource NullBooleanConverter}}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf0c5;" IconStyle="Light" Size="15" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Save" InputGestureText="Ctrl+S" Command="{Binding SaveImageCommand}" CommandParameter="{Binding Result}" IsEnabled="{Binding Result, Converter={StaticResource NullBooleanConverter}}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Light" Size="15"/>
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </userControls:ImageElement.ContextMenu>

            </userControls:ImageElement>

        </DockPanel>
    </Border>
</UserControl>
