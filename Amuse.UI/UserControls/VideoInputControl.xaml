<UserControl x:Class="Amuse.UI.UserControls.VideoInputControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:effects="clr-namespace:Amuse.UI.Effects"
             xmlns:userControls="clr-namespace:Amuse.UI.UserControls"
             Name="UI"
             Focusable="True" 
             AllowDrop="True">
    <UserControl.InputBindings>
        <KeyBinding Modifiers="Ctrl" Key="O" Command="{Binding LoadVideoCommand, ElementName=UI}" />
        <KeyBinding Modifiers="Ctrl" Key="C" Command="{Binding CopyVideoCommand, ElementName=UI}" />
        <KeyBinding Modifiers="Ctrl" Key="V" Command="{Binding PasteVideoCommand, ElementName=UI}" />
        <KeyBinding Modifiers="Ctrl" Key="S" Command="{Binding SaveVideoCommand, ElementName=UI}" />
    </UserControl.InputBindings>
    <Border DataContext="{Binding ElementName=UI}" BorderBrush="{StaticResource ControlBrightDefaultBorderBrush}"  BorderThickness="2" >
        <DockPanel Margin="2" >

            <StackPanel DockPanel.Dock="Bottom" Visibility="{Binding ToolbarVisibility}">
                <UniformGrid  Columns="1" Height="30" Visibility="{Binding Result, Converter={StaticResource NullVisibilityConverter}}">
                    <DockPanel HorizontalAlignment="Left" Margin="0,3" MaxWidth="500">
                        <TextBlock DockPanel.Dock="Left" Text="Video File:" Margin="5,0,0,0"  FontSize="10" Opacity=".6" VerticalAlignment="Center" FontStyle="Italic"/>
                        <TextBlock Text="{Binding Result.FileName, Converter={StaticResource FullPathToFileNameConverter}}" Margin="5,0,0,0" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                    </DockPanel>
                </UniformGrid>
                <DockPanel  Height="30" >
                    <Button DockPanel.Dock="Right" Command="{Binding ClearVideoCommand}" Width="50" IsEnabled="{Binding Result, Converter={StaticResource NullBooleanConverter}}" Style="{StaticResource DangerButtonStyle}">
                        <userControls:FontAwesome Icon="&#xf2ed;" IconStyle="Light" Color="{StaticResource DangerColour}" />
                    </Button>

                    <Button DockPanel.Dock="Left" Command="{Binding LoadVideoCommand}" ToolTip="Load Video File" Width="80" Style="{StaticResource InfoButtonStyle}" >
                        <StackPanel Orientation="Horizontal">
                            <userControls:FontAwesome Icon="&#xf0ee;" IconStyle="Light" Color="{StaticResource InfoColour}" />
                            <TextBlock Text="Load" Margin="5,0,0,0" Foreground="{StaticResource InfoColour}"/>
                        </StackPanel>
                    </Button>

                    <DockPanel>
                        <StackPanel Margin="5,0">
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="Frames:" Margin="0,0,8,0"  FontSize="10" Opacity=".6" VerticalAlignment="Center" FontStyle="Italic"/>
                                <TextBlock Text="{Binding Result.Video.FrameCount}" Margin="0,0,5,0"/>
                                <TextBlock Text="Duration:" Margin="0,0,8,0"  FontSize="10" Opacity=".6" VerticalAlignment="Center" FontStyle="Italic"/>
                                <TextBlock Text="{Binding Result.Video.Duration, FallbackValue=00:00:00, StringFormat={}mm\\:ss\\.ffff}" />
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,-2,0,0">
                                <TextBlock Text="Video Info:" Margin="0,0,3,0"  FontSize="10" Opacity=".6" VerticalAlignment="Center" FontStyle="Italic"/>
                                <TextBlock Text="{Binding Result.Video.Width, FallbackValue=0}" />
                                <TextBlock Text=" x " Opacity=".7" VerticalAlignment="Center" FontStyle="Italic"/>
                                <TextBlock Text="{Binding Result.Video.Height, FallbackValue=0}" />
                                <TextBlock Text=" @ " FontSize="11" Opacity=".7" VerticalAlignment="Center" FontStyle="Italic"/>
                                <TextBlock Text="{Binding Result.Video.FrameRate, FallbackValue=0}" />
                                <TextBlock Text=" fps" FontSize="11" Opacity=".7" VerticalAlignment="Center" FontStyle="Italic"/>
                            </StackPanel>
                        </StackPanel>
                    </DockPanel>

                </DockPanel>
            </StackPanel>

            <!--Video-->
            <Grid PreviewMouseLeftButtonDown="Control_PreviewMouseLeftButtonUp">
                <userControls:VideoElement
                    IsSplitterEnabled="False"
                    Source="{Binding Result.FileName}"
                    Preview="{Binding PreviewImage}"
                    VideoSync="{Binding VideoSync}"/>
                <Grid VerticalAlignment="Bottom" Margin="0,0,0,20" Visibility="{Binding Result, Converter={StaticResource InverseNullVisibilityConverter}}">
                    <TextBlock Text="Drag &amp; Drop Your Video Here" TextAlignment="Center" Opacity=".6"/>
                </Grid>

                <!--ContextMenu-->
                <Grid.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="Open" InputGestureText="Ctrl+O" Command="{Binding LoadVideoCommand}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf1c5;" IconStyle="Light" Size="15" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Copy" InputGestureText="Ctrl+C" Command="{Binding CopyVideoCommand}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf0c5;" IconStyle="Light" Size="15" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Paste" InputGestureText="Ctrl+V" Command="{Binding PasteVideoCommand}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf0ea;" IconStyle="Light" Size="15" />
                            </MenuItem.Icon>
                        </MenuItem>
                        <MenuItem Header="Save" InputGestureText="Ctrl+S" Command="{Binding SaveVideoCommand}" >
                            <MenuItem.Icon>
                                <userControls:FontAwesome Icon="&#xf0c7;" IconStyle="Light" Size="15" />
                            </MenuItem.Icon>
                        </MenuItem>
                    </ContextMenu>
                </Grid.ContextMenu>
            </Grid>

        </DockPanel>
    </Border>
</UserControl>
