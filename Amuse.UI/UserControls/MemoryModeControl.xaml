<UserControl x:Class="Amuse.UI.UserControls.MemoryModeControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             xmlns:userControls="clr-namespace:Amuse.UI.UserControls"
             Name="MemoryModeUI">
    <StackPanel DataContext="{Binding ElementName=MemoryModeUI}">
        <UniformGrid Columns="2">
            <StackPanel>
                <TextBlock Style="{StaticResource FieldTextBlockStyle}">Memory Mode</TextBlock>
                <DockPanel>
                    <ToggleButton DockPanel.Dock="Right" IsChecked="{Binding IsMinimized}" Style="{StaticResource ToggleButtonBasic}" Width="24">
                        <userControls:FontAwesome Icon="&#xf1de;" IconStyle="Light" Size="12"/>
                    </ToggleButton>
                    <ComboBox ItemsSource="{Binding Source={StaticResource MemoryMode}}" SelectedItem="{Binding MemoryMode}" Style="{StaticResource EnumComboBox}"/>
                </DockPanel>
            </StackPanel>
            <Grid Visibility="{Binding IsPipelineLoaded, TargetNullValue=Hidden, FallbackValue=Hidden, Converter={StaticResource BooleanToVisibilityConverter}}" ToolTipService.InitialShowDelay="200" ToolTipService.Placement="Top" ToolTipService.VerticalOffset="10">
                <StackPanel HorizontalAlignment="Right" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="15,0,4,0" TextBlock.FontSize="14">
                    <Grid DockPanel.Dock="Left" Margin="0,0,5,0">
                        <userControls:FontAwesome IconStyle="Light" Margin="0,1,0,0" >
                            <userControls:FontAwesome.Style>
                                <Style TargetType="{x:Type userControls:FontAwesome}" BasedOn="{StaticResource {x:Type userControls:FontAwesome}}">
                                    <Setter Property="Icon" Value="&#xf058;" />
                                    <Setter Property="Color" Value="{StaticResource AccentColour2}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding MemoryInfo.IsMaximumSupported}" Value="False">
                                            <Setter Property="Icon" Value="&#xf058;" />
                                            <Setter Property="Color" Value="{StaticResource InfoColour}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding MemoryInfo.IsMemoryAvailable}" Value="False">
                                            <Setter Property="Icon" Value="&#xf06a;" />
                                            <Setter Property="Color" Value="{StaticResource WarningColour}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding MemoryInfo.IsMaximumSupported}" Value="True">
                                            <Setter Property="Icon" Value="&#xf058;" />
                                            <Setter Property="Color" Value="{StaticResource AccentColour2}" />
                                        </DataTrigger>
                                        <DataTrigger Binding="{Binding MemoryInfo.IsUnsupported}" Value="True">
                                            <Setter Property="Icon" Value="&#xf06a;" />
                                            <Setter Property="Color" Value="{StaticResource DangerColour}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </userControls:FontAwesome.Style>
                        </userControls:FontAwesome>
                        <Grid.Style>
                            <Style TargetType="{x:Type Grid}">
                                <Setter Property="Visibility" Value="Visible" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding MemoryInfo.DeviceMemory, TargetNullValue=0, FallbackValue=0}" Value="0">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                    </Grid>
                    <TextBlock Text="{Binding MemoryInfo.MemoryRequired, FallbackValue=0.0GB, StringFormat={}{0:F1}GB}" Opacity=".9"/>
                    <TextBlock Text="/" Opacity=".5" Margin="3,0,2,0"/>
                    <TextBlock Text="{Binding MemoryInfo.DeviceMemory, FallbackValue=0.0GB, StringFormat={}{0:F1}GB}" Opacity=".9"/>
                </StackPanel>
                <Grid.ToolTip>
                    <Grid>
                        <StackPanel Margin="0,5">
                            <StackPanel Orientation="Horizontal" >
                                <userControls:FontAwesome Icon="&#xf058;" IconStyle="Light" Color="{StaticResource AccentColour2}"/>
                                <TextBlock Text="Memory Available" Margin="4,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <userControls:FontAwesome Icon="&#xf058;" IconStyle="Light" Color="{StaticResource InfoColour}"/>
                                <TextBlock Text="Memory Partial OffLoad" Margin="4,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <userControls:FontAwesome Icon="&#xf06a;" IconStyle="Light" Color="{StaticResource WarningColour}"/>
                                <TextBlock Text="Shared Memory Required" Margin="4,0,0,0"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                                <userControls:FontAwesome Icon="&#xf06a;" IconStyle="Light" Color="{StaticResource DangerColour}"/>
                                <TextBlock Text="Insufficient Resources" Margin="4,0,0,0"/>
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Grid.ToolTip>
            </Grid>
        </UniformGrid>
        <UniformGrid Columns="2" Margin="5,5,0,0" Visibility="{Binding IsMinimized, Converter={StaticResource InverseBooleanToVisibilityConverter}}" IsEnabled="{Binding MemoryMode, Converter={StaticResource EnumToBoolConverter}, ConverterParameter=Custom}">
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Unload Pipeline" IsChecked="{Binding MemoryInfo.IsLowMemoryPipelineEnabled}" />
            </StackPanel>
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Unload Encoder" IsChecked="{Binding MemoryInfo.IsLowMemoryEncoderEnabled}" />
            </StackPanel>
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Unload Decoder" IsChecked="{Binding MemoryInfo.IsLowMemoryDecoderEnabled}" />
            </StackPanel>
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Unload Compute" IsChecked="{Binding MemoryInfo.IsLowMemoryComputeEnabled}" />
            </StackPanel>
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Unload TextEncoder" IsChecked="{Binding MemoryInfo.IsLowMemoryTextEncoderEnabled}" />
            </StackPanel>
            <StackPanel VerticalAlignment="Top"  Margin="0,3,0,0">
                <CheckBox Content="Enable VAE Tiling" IsChecked="{Binding MemoryInfo.IsVaeTileEnabled}" />
            </StackPanel>
        </UniformGrid>
    </StackPanel>
</UserControl>
